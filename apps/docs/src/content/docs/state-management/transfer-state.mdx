---
title: Transfer state
description: State integration isolated by request that is transferred from server to client
sidebar:
  badge:
    text: Featured
    variant: tip
---
import { Code, Tabs, TabItem, Aside, Steps } from '@astrojs/starlight/components';

import { Example, ExamplePreview } from '@astro-tools/docs-utils/example';

import TransferStateExample from './_examples/transfer-state/before-hydration/Example.astro';
import TransferStateAfterHydrationExample from './_examples/transfer-state/after-hydration/Example.astro';

import setupExampleRaw from './_examples/transfer-state/setup.ts?raw';
import transferStateExampleRaw from './_examples/transfer-state/before-hydration/Example.astro?raw';
import transferStateExampleChildRaw from './_examples/transfer-state/before-hydration/Example.svelte?raw';
import transferStateAfterHydrationExampleRaw from './_examples/transfer-state/after-hydration/Example.astro?raw';
import transferStateAfterHydrationExampleChildRaw from './_examples/transfer-state/after-hydration/Example.svelte?raw';
import outputCodeExample from '@astro-tools/docs-utils/components/Output.svelte?raw';

The Transfer state integration allows you to manage the state of your application isolated by request and transferred from the server to the client.

With this, instead of having to use `Astro.locals` for isolation and pass every value to the UI frameworks through properties or custom scripts, you can use the `setState` and `getState` functions to share the state between Astro and any UI framework component (Svelte, SolidJS, React...).

<Aside type="caution">Adding this integration will disable stream rendering because the state must be available before executing any client script.</Aside>

## Setup

For setting up the state management with request isolation and transfer state, include the integration in your Astro project.

<Steps>
1.  Install the library using your preferred package manager:
    ```
    npm i -D @astro-tools/transfer-state
    ```
2.  Add the integration to your project configuration:
    <Code title="astro.config.mjs" code={setupExampleRaw} lang="typescript" />
</Steps>

## Use

For using the state management, just use `setState` and `getState` methods:

### setState
Use `setState` with a key to save the value (JSON-like) into the state. Keys can be removed using `null` as value.

```typescript
import type { MyData } from './my-data';

const myData: MyData = { name: 'example' };
setState('my-data', myData);
```

### getState
Use `getState` to get the current value of a key. When there is no value, `null` will be returned.

```typescript
import type { MyData } from './my-data';

const myData = getState<MyData>('my-data');
```

<Aside type="note">The `setState` and `getState` methods will work in client-side without issues. The state will be loaded from the server-side and then kept in memory.</Aside>

## Examples

The state can be used to render server-side UI framework components, like the one in this example.

The `Example.svelte` is rendered in server-side using the `uuid` state and transferred to the client. The hydration process keeps the value is it is.

<Example>
  <Tabs>
    <TabItem label="Example.astro">
      <Code code={transferStateExampleRaw} lang="astro" />
    </TabItem>
    <TabItem label="Example.svelte">
      <Code code={transferStateExampleChildRaw} lang="astro" />
    </TabItem>
    <TabItem label="Output.svelte">
      <Code code={outputCodeExample} lang="svelte" />
    </TabItem>
  </Tabs>
  <ExamplePreview hydration="example">
    <TransferStateExample id="example" />
  </ExamplePreview>
</Example>

Also, the state value can be recovered at any moment, for example, after hydration or any logic you want.

<Example>
  <Tabs>
    <TabItem label="Example.astro">
      <Code code={transferStateAfterHydrationExampleRaw} lang="astro" />
    </TabItem>
    <TabItem label="Example.svelte">
      <Code code={transferStateAfterHydrationExampleChildRaw} lang="astro" />
    </TabItem>
    <TabItem label="Output.svelte">
      <Code code={outputCodeExample} lang="svelte" />
    </TabItem>
  </Tabs>
  <ExamplePreview hydration="example-after-hydration">
    <TransferStateAfterHydrationExample id="example-after-hydration" />
  </ExamplePreview>
</Example>

